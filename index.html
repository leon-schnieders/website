<head>  </head>
<body style="display: flex; justify-content: center;">

  
  
  <div style="max-width: 800px; width:100%">
    
    <h3>API Testing Zone</h3><br>
    
    
    <h1> User Info </h1>

    <div class="form" >
      
      <label for="fname">Vorame:</label><br>
      <input type="text" id="name" value="Leon"><br>
    
      <label for="fname">Stadt:</label><br>
      <input type="text" id="city" value="Bochum"><br>
      
      <label for="fname">Schwarzer humor: </label><br>
      <input type="checkbox" id="humor"> <br>
    
      <button onclick="fetchData()">Lets Go</button>
    
    </div>
      
      
    <h2> Wetter </h2>
  
    <p id="weather_text"> hmm </p>
    
    <h2> Person </h2>
    
    <p id="age_text"> hmm </p>
    
    <h2> Joke </h2>
    
    <p id="joke_text"> hmm </p>

  </div>

  <style>
    
    .form :is(label, input, button){
      margin: 5px;
      pading: 5px;
      min-width: 200px;
    }
    
  </style>
  
  
  <script>
  
    console.log("Hello world");
  
    var weather_p = document.getElementById("weather_text");
  
    var weather_data;
  
    function getWether(API_data){  
      var t = "Wetter in " + API_data.name + " : " + API_data.weather[0].description;
      console.log(t);
      weather_p.innerHTML =  t;
    }
  
 
  
    function fetchWeather(my_lat , my_lon){
        
      var lat = 51.48184;
    
      var lon = 7.216236;
    
      if( typeof my_lat !== "undefined") { lat = my_lat; }
    
      if( typeof my_lon !== "undefined") { lon = my_lon; }
    
      var fetch_url = 'https://api.openweathermap.org/data/2.5/weather?lat=' + lat + '6&lon=' + lon + '&appid=d1ffef114ff90bd71199fb1b8d279642';
        
      fetch(fetch_url)
      .then(response => {
        return response.json();
      })
      .then(users => {
        console.log("Wetter");
        console.log(users);
        weather_data = users;
        getWether(users);
      });
    }
  

    var my_location;
    
    function fetchLocation(city_name){
      
      
      if (typeof city_name == "undefined"){ 
        console.log("keine city");
        city_name = "Bochum";
      }
      
      var fetch_url ='https://api.openweathermap.org/geo/1.0/direct?q=' + city_name + '&limit=5&appid=d1ffef114ff90bd71199fb1b8d279642'
      
      fetch(fetch_url)
      .then(response => { 
        return response.json();              
      })
      .then(users => {
        console.log("Location");
        console.log(users);
        my_location = users[0];
        fetchWeather(my_location.lat,my_location.lon);
      });
    }
    
    
    
    var age_p = document.getElementById("age_text");
    
    function fetchAge(person_name){
    
      var fetch_url = 'https://api.agify.io?name=' + person_name;
      
      fetch(fetch_url)
      .then(response => { 
        return response.json();              
      })
      .then(users => {
        console.log("Name");
        console.log(users);
        age_p.innerHTML = "geschÃ¤tztes Alter: " + users.age ;
      });
      
    }
    
    var joke_p = document.getElementById("joke_text");
    
    function fetchJoke(dark){
      
      fetch('https://v2.jokeapi.dev/joke/Any')
      .then(response => { 
        return response.json();              
      })
      .then(users => {
        console.log("Dark Joke:" + dark);
        console.log(users);
        if (dark != users.safe){
          joke_p.innerHTML = users.setup + " | " + users.delivery;
        } else { fetchJoke(dark); }
      });
      
    }
    
    
    
    function fetchData(){
      
      console.log("fetching...")
      
      var city_name = document.getElementById("city").value;
      
      fetchLocation(city_name);
      
      var person_name = document.getElementById("name").value;
      
      fetchAge(person_name);
      
      var humor = document.getElementById("humor").is(':checked') ;
          
      fetchJoke(humor == "on");
    }
    
    
   
  
  </script>
</body>
